{"version":3,"file":"../pages/api/revalidate.js","mappings":"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","sources":["webpack://@mintlify/client/external commonjs \"@sentry/nextjs\"","webpack://@mintlify/client/external commonjs \"next/dist/compiled/next-server/pages-api.runtime.prod.js\"","webpack://@mintlify/client/src/pages/api/revalidate.ts","webpack://@mintlify/client/sentry-wrapper-module","webpack://@mintlify/client/../../node_modules/next/dist/build/templates/helpers.js?4d71","webpack://@mintlify/client/?ee05","webpack://@mintlify/client/./src/env.ts","webpack://@mintlify/client/./src/utils/intoChunks.ts","webpack://@mintlify/client/../../node_modules/next/dist/server/future/route-kind.js?9654","webpack://@mintlify/client/../../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js","webpack://@mintlify/client/../../packages/common/dist/secureCompare.js?24d4"],"sourcesContent":["module.exports = require(\"@sentry/nextjs\");","module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.prod.js\");","import { secureCompare } from '@mintlify/common';\nimport { NextApiRequest, NextApiResponse } from 'next';\n\nimport { REVALIDATION_TOKEN } from '@/env';\nimport { intoChunks } from '@/utils/intoChunks';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  const body = req.body as { secret?: string; paths?: string[]; path?: string };\n  if (\n    body.secret == undefined ||\n    REVALIDATION_TOKEN == undefined ||\n    !secureCompare(body.secret, REVALIDATION_TOKEN)\n  ) {\n    return res.status(401).json({ revalidated: false, error: 'Invalid token' });\n  }\n\n  if (!body.path && (body.paths?.length ?? 0) < 1) {\n    return res.status(400).json({ revalidated: false, error: 'No path provided' });\n  }\n\n  const paths = new Set(body.paths ?? []);\n  if (body.path) paths.add(body.path);\n  const pathArray = [...paths.values()];\n\n  try {\n    for (const sitePaths of intoChunks(pathArray, 32)) {\n      await Promise.all(sitePaths.map((x) => res.revalidate(x)));\n    }\n\n    return res.json({ revalidated: true });\n  } catch (error) {\n    console.error(`Revalidating ${pathArray.join(', ')} failed: `, error);\n    return res.status(500).json({ revalidated: false, error });\n  }\n}\n","import * as Sentry from '@sentry/nextjs';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\n\n/*\n * This file is a template for the code which will be substituted when our webpack loader handles API files in the\n * `pages/` directory.\n *\n * We use `__SENTRY_WRAPPING_TARGET_FILE__.cjs` as a placeholder for the path to the file being wrapped. Because it's not a real package,\n * this causes both TS and ESLint to complain, hence the pragma comments below.\n */\n\n\nconst userApiModule = serverComponentModule ;\n\n// Default to undefined. It's possible for Next.js users to not define any exports/handlers in an API route. If that is\n// the case Next.js wil crash during runtime but the Sentry SDK should definitely not crash so we need tohandle it.\nlet userProvidedHandler = undefined;\n\nif ('default' in userApiModule && typeof userApiModule.default === 'function') {\n  // Handle when user defines via ESM export: `export default myFunction;`\n  userProvidedHandler = userApiModule.default;\n} else if (typeof userApiModule === 'function') {\n  // Handle when user defines via CJS export: \"module.exports = myFunction;\"\n  userProvidedHandler = userApiModule;\n}\n\nconst origConfig = userApiModule.config || {};\n\n// Setting `externalResolver` to `true` prevents nextjs from throwing a warning in dev about API routes resolving\n// without sending a response. It's a false positive (a response is sent, but only after we flush our send queue), and\n// we throw a warning of our own to tell folks that, but it's better if we just don't have to deal with it in the first\n// place.\nconst config = {\n  ...origConfig,\n  api: {\n    ...origConfig.api,\n    externalResolver: true,\n  },\n};\n\nlet wrappedHandler = userProvidedHandler;\n\nif (wrappedHandler && undefined) {\n  wrappedHandler = Sentry.wrapApiHandlerWithSentryVercelCrons(wrappedHandler, undefined);\n}\n\nif (wrappedHandler) {\n  wrappedHandler = Sentry.wrapApiHandlerWithSentry(wrappedHandler, '/api/revalidate');\n}\n\nconst wrappedHandler$1 = wrappedHandler;\n\nexport { config, wrappedHandler$1 as default };\n","/**\n * Hoists a name from a module or promised module.\n *\n * @param module the module to hoist the name from\n * @param name the name to hoist\n * @returns the value on the module (or promised module)\n */ \"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"hoist\", {\n    enumerable: true,\n    get: function() {\n        return hoist;\n    }\n});\nfunction hoist(module, name) {\n    // If the name is available in the module, return it.\n    if (name in module) {\n        return module[name];\n    }\n    // If a property called `then` exists, assume it's a promise and\n    // return a promise that resolves to the name.\n    if (\"then\" in module && typeof module.then === \"function\") {\n        return module.then((mod)=>hoist(mod, name));\n    }\n    // If we're trying to hoise the default export, and the module is a function,\n    // return the module itself.\n    if (typeof module === \"function\" && name === \"default\") {\n        return module;\n    }\n    // Otherwise, return undefined.\n    return undefined;\n}\n\n//# sourceMappingURL=helpers.js.map","import { PagesAPIRouteModule } from \"next/dist/server/future/route-modules/pages-api/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { hoist } from \"next/dist/build/templates/helpers\";\n// Import the userland code.\nimport * as userland from \"private-next-pages/api/revalidate.ts\";\n// Re-export the handler (should be the default export).\nexport default hoist(userland, \"default\");\n// Re-export config.\nexport const config = hoist(userland, \"config\");\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesAPIRouteModule({\n    definition: {\n        kind: RouteKind.PAGES_API,\n        page: \"/api/revalidate\",\n        pathname: \"/api/revalidate\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland\n});\n\n//# sourceMappingURL=pages-api.js.map","export const REVALIDATION_TOKEN = process.env.REVALIDATION_TOKEN;\nexport const EXPORT_TOKEN = process.env.EXPORT_TOKEN;\nexport const INTERNAL_ANALYTICS_WRITE_KEY = process.env.INTERNAL_ANALYTICS_WRITE_KEY;\nexport const BASE_PATH = process.env.BASE_PATH || '';\nexport const HOST_NAME = process.env.HOST_NAME || '';\n// eslint-disable-next-line\nexport const NODE_ENV = process.env.NODE_ENV || 'development';\n\n// Boolean flags\nexport const IS_MULTI_TENANT = process.env.IS_MULTI_TENANT === 'true';\nexport const VERCEL = process.env.VERCEL === '1';\n\n/**\n *\n *\n * Public next.js environment variables - NO SECRETS\n *\n *\n * Unlike other env variables, env variables prefixed with `NEXT_PUBLIC_` will be injected into client-side code.\n * This means we **MUST NOT** use this pattern for any env variables containing secrets.\n *\n * Because next.js does inline replacement, these env vars must be referenced using `process.env.NEXT_PUBLIC_*****`\n * (no object destructuring).\n */\nexport const NEXT_PUBLIC = {\n  SENTRY_DSN: process.env.NEXT_PUBLIC_SENTRY_DSN,\n  ENV: process.env.NEXT_PUBLIC_ENV || 'local',\n  TRIEVE_API_KEY: process.env.NEXT_PUBLIC_TRIEVE_API_KEY,\n  AUTH_ENABLED: process.env.NEXT_PUBLIC_AUTH_ENABLED,\n  CUSTOM_JS_DISABLED: process.env.NEXT_PUBLIC_CUSTOM_JS_DISABLED,\n  ASSET_PREFIX: process.env.NEXT_PUBLIC_ASSET_PREFIX ?? '',\n};\n","export function* intoChunks<T>(values: T[], chunkSize = 16) {\n  for (let i = 0; i < values.length; i += chunkSize) {\n    const chunk = values.slice(i, i + chunkSize);\n    yield chunk;\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"RouteKind\", {\n    enumerable: true,\n    get: function() {\n        return RouteKind;\n    }\n});\nvar RouteKind;\n(function(RouteKind) {\n    /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */ RouteKind[\"PAGES\"] = \"PAGES\";\n    /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */ RouteKind[\"PAGES_API\"] = \"PAGES_API\";\n    /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */ RouteKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */ RouteKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n})(RouteKind || (RouteKind = {}));\n\n//# sourceMappingURL=route-kind.js.map","\"use strict\";\nif (process.env.NEXT_RUNTIME === \"edge\") {\n    module.exports = require(\"next/dist/server/future/route-modules/pages-api/module.js\");\n} else {\n    if (process.env.NODE_ENV === \"development\") {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.dev.js\");\n    } else if (process.env.TURBOPACK) {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js\");\n    } else {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.prod.js\");\n    }\n}\n\n//# sourceMappingURL=module.compiled.js.map","export function secureCompare(a, b) {\n    let mismatch = a.length === b.length ? 0 : 1;\n    if (mismatch) {\n        b = a;\n    }\n    for (let i = 0, il = a.length; i < il; ++i) {\n        mismatch |= a.charCodeAt(i) ^ b.charCodeAt(i);\n    }\n    return mismatch === 0;\n}\n"],"names":["module","exports","require","userProvidedHandler","handler","req","res","body","undefined","secret","REVALIDATION_TOKEN","secureCompare","status","json","revalidated","error","path","paths","length","Set","add","pathArray","values","sitePaths","intoChunks","Promise","all","map","revalidate","x","console","join","serverComponentModule","userApiModule","default","origConfig","config","api","externalResolver","wrappedHandler","_sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__","wrapApiHandlerWithSentry","wrappedHandler$1","Object","defineProperty","enumerable","get","hoist","name","then","mod","__WEBPACK_DEFAULT_EXPORT__","next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__","l","private_next_pages_api_revalidate_ts__WEBPACK_IMPORTED_MODULE_3__","routeModule","next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__","PagesAPIRouteModule","definition","kind","next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__","PAGES_API","page","pathname","bundlePath","filename","userland","process","env","EXPORT_TOKEN","INTERNAL_ANALYTICS_WRITE_KEY","BASE_PATH","HOST_NAME","NODE_ENV","IS_MULTI_TENANT","VERCEL","NEXT_PUBLIC","SENTRY_DSN","NEXT_PUBLIC_SENTRY_DSN","ENV","TRIEVE_API_KEY","NEXT_PUBLIC_TRIEVE_API_KEY","AUTH_ENABLED","NEXT_PUBLIC_AUTH_ENABLED","CUSTOM_JS_DISABLED","NEXT_PUBLIC_CUSTOM_JS_DISABLED","ASSET_PREFIX","NEXT_PUBLIC_ASSET_PREFIX","chunkSize","i","chunk","slice","RouteKind","__webpack_require__","a","b","mismatch","il","charCodeAt"],"sourceRoot":""}