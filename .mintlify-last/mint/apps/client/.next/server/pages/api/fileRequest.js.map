{"version":3,"file":"../pages/api/fileRequest.js","mappings":"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","sources":["webpack://@mintlify/client/external commonjs \"@sentry/nextjs\"","webpack://@mintlify/client/external commonjs \"next/dist/compiled/next-server/pages-api.runtime.prod.js\"","webpack://@mintlify/client/external commonjs2 \"fs\"","webpack://@mintlify/client/external module \"axios\"","webpack://@mintlify/client/external module \"formidable\"","webpack://@mintlify/client/src/pages/api/fileRequest.ts","webpack://@mintlify/client/sentry-wrapper-module","webpack://@mintlify/client/../../node_modules/next/dist/build/templates/helpers.js?4d71","webpack://@mintlify/client/?6471","webpack://@mintlify/client/external commonjs2 \"net\"","webpack://@mintlify/client/./src/utils/api/isSafeRequestUrl.ts","webpack://@mintlify/client/../../node_modules/next/dist/server/future/route-kind.js?9654","webpack://@mintlify/client/../../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js"],"sourcesContent":["module.exports = require(\"@sentry/nextjs\");","module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.prod.js\");","module.exports = require(\"fs\");","module.exports = import(\"axios\");;","module.exports = import(\"formidable\");;","import { ApiPlaygroundResultType } from '@mintlify/models';\nimport axios, { isAxiosError } from 'axios';\nimport formidable, { Fields, Files } from 'formidable';\nimport fs from 'fs';\nimport { NextApiRequest, NextApiResponse } from 'next';\n\nimport { RequestInfo } from '@/hooks/useSendPlaygroundRequest';\nimport { isSafeRequestUrl } from '@/utils/api/isSafeRequestUrl';\n\nexport const config = {\n  api: {\n    bodyParser: false,\n  },\n};\n\nasync function handler(req: NextApiRequest, res: NextApiResponse<ApiPlaygroundResultType>) {\n  try {\n    const form = formidable({});\n    const [fields, files] = (await form.parse(req)) as [Fields, Files];\n\n    const requestInfo: RequestInfo = JSON.parse(fields.requestInfo?.[0] || '{}');\n\n    const { url, method, header, query, cookie: _cookie } = requestInfo;\n\n    if (!isSafeRequestUrl(url)) {\n      return res.send({\n        error: true,\n        errorMessage: 'invalid URL',\n      });\n    }\n\n    const data = toFormData(fields, files);\n    const headers = { ...header } as Record<string, string>;\n    delete headers['content-type'];\n\n    const response = await axios({\n      url,\n      method,\n      params: query,\n      data,\n      headers,\n      paramsSerializer: {\n        indexes: null,\n      },\n      responseEncoding: 'base64',\n      validateStatus: () => true,\n      transformResponse: (data) => data,\n    });\n\n    return res.send({\n      error: false,\n      response: {\n        status: response.status,\n        statusText: response.statusText,\n        headers: response.headers,\n        data: response.data,\n      },\n    });\n  } catch (error) {\n    console.error(error);\n    /**\n     * handle errors based on the axios error handling guide\n     * (don't need to handle the `if error.response` case, since we allow all statuses)\n     *\n     * https://github.com/axios/axios#handling-errors\n     */\n    const errorMessage = isAxiosError(error)\n      ? error.request\n        ? 'no response received'\n        : 'unable to create request'\n      : 'an unknown error occurred';\n    return res.send({\n      error: true,\n      errorMessage,\n    });\n  }\n}\n\nconst toFormData = (fields: Fields, files: Files) => {\n  const formData = new FormData();\n  Object.entries(files).forEach(([key, file]) => {\n    if (file && file[0]) {\n      const formidableFile = file[0];\n      const fileBuffer = fs.readFileSync(formidableFile.filepath);\n      const blob = new Blob([fileBuffer], {\n        type: formidableFile.mimetype || 'application/octet-stream',\n      });\n      formData.append(key, blob, formidableFile.originalFilename || 'file');\n    }\n  });\n  Object.entries(fields).forEach(([key, value]) => {\n    if (key !== 'requestInfo' && value && value[0]) {\n      formData.append(key, value[0]);\n    }\n  });\n\n  return formData;\n};\n\nexport default handler;\n","import * as Sentry from '@sentry/nextjs';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\n\n/*\n * This file is a template for the code which will be substituted when our webpack loader handles API files in the\n * `pages/` directory.\n *\n * We use `__SENTRY_WRAPPING_TARGET_FILE__.cjs` as a placeholder for the path to the file being wrapped. Because it's not a real package,\n * this causes both TS and ESLint to complain, hence the pragma comments below.\n */\n\n\nconst userApiModule = serverComponentModule ;\n\n// Default to undefined. It's possible for Next.js users to not define any exports/handlers in an API route. If that is\n// the case Next.js wil crash during runtime but the Sentry SDK should definitely not crash so we need tohandle it.\nlet userProvidedHandler = undefined;\n\nif ('default' in userApiModule && typeof userApiModule.default === 'function') {\n  // Handle when user defines via ESM export: `export default myFunction;`\n  userProvidedHandler = userApiModule.default;\n} else if (typeof userApiModule === 'function') {\n  // Handle when user defines via CJS export: \"module.exports = myFunction;\"\n  userProvidedHandler = userApiModule;\n}\n\nconst origConfig = userApiModule.config || {};\n\n// Setting `externalResolver` to `true` prevents nextjs from throwing a warning in dev about API routes resolving\n// without sending a response. It's a false positive (a response is sent, but only after we flush our send queue), and\n// we throw a warning of our own to tell folks that, but it's better if we just don't have to deal with it in the first\n// place.\nconst config = {\n  ...origConfig,\n  api: {\n    ...origConfig.api,\n    externalResolver: true,\n  },\n};\n\nlet wrappedHandler = userProvidedHandler;\n\nif (wrappedHandler && undefined) {\n  wrappedHandler = Sentry.wrapApiHandlerWithSentryVercelCrons(wrappedHandler, undefined);\n}\n\nif (wrappedHandler) {\n  wrappedHandler = Sentry.wrapApiHandlerWithSentry(wrappedHandler, '/api/fileRequest');\n}\n\nconst wrappedHandler$1 = wrappedHandler;\n\nexport { config, wrappedHandler$1 as default };\n","/**\n * Hoists a name from a module or promised module.\n *\n * @param module the module to hoist the name from\n * @param name the name to hoist\n * @returns the value on the module (or promised module)\n */ \"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"hoist\", {\n    enumerable: true,\n    get: function() {\n        return hoist;\n    }\n});\nfunction hoist(module, name) {\n    // If the name is available in the module, return it.\n    if (name in module) {\n        return module[name];\n    }\n    // If a property called `then` exists, assume it's a promise and\n    // return a promise that resolves to the name.\n    if (\"then\" in module && typeof module.then === \"function\") {\n        return module.then((mod)=>hoist(mod, name));\n    }\n    // If we're trying to hoise the default export, and the module is a function,\n    // return the module itself.\n    if (typeof module === \"function\" && name === \"default\") {\n        return module;\n    }\n    // Otherwise, return undefined.\n    return undefined;\n}\n\n//# sourceMappingURL=helpers.js.map","import { PagesAPIRouteModule } from \"next/dist/server/future/route-modules/pages-api/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { hoist } from \"next/dist/build/templates/helpers\";\n// Import the userland code.\nimport * as userland from \"private-next-pages/api/fileRequest.ts\";\n// Re-export the handler (should be the default export).\nexport default hoist(userland, \"default\");\n// Re-export config.\nexport const config = hoist(userland, \"config\");\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesAPIRouteModule({\n    definition: {\n        kind: RouteKind.PAGES_API,\n        page: \"/api/fileRequest\",\n        pathname: \"/api/fileRequest\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland\n});\n\n//# sourceMappingURL=pages-api.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"net\");","import { isIP } from 'net';\n\nconst urlSubstringBlacklist = [\n  '127.0.0.1',\n  '127.1',\n  '127.000.000.1',\n  'localhost',\n  '127.0.0.2',\n  '0x7f.0x0.0x0.0x1',\n  '0177.0.0.01',\n  '01111111000000000000000000000001',\n  '01111111.00000000.00000000.00000001',\n  '2130706433',\n  '017700000001',\n  '%6c%6f%63%61%6c%68%6f%73%74',\n  '0177.0.0.0x1',\n  '169.254.169.254',\n  '169.254.169.254/latest/meta-data/iam/security-credentials/',\n  '169.254.169.254/latest/meta-data/hostname',\n  'fuf.me',\n  'localtest.me',\n  'ulh.us',\n  '127-0-0-1.org.uk',\n  'ratchetlocal.com',\n  'smackaho.st',\n  '42foo.com',\n  'vcap.me',\n  'beweb.com',\n  'yoogle.com',\n  'ortkut.com',\n  'feacebook.com',\n  'lvh.me',\n  '127.127.127.127',\n  '127.0.0.0',\n  '1.1.1.1 &@2.2.2.2# @3.3.3.3',\n  'urllib: 3.3.3.3',\n  'amazonaws.com',\n  '[::]',\n  '0000',\n];\nconst urlExactBlacklist = ['0'];\n\nexport function isSafeRequestUrl(urlString: string) {\n  let url;\n  try {\n    url = new URL(urlString);\n  } catch {\n    return false;\n  }\n\n  const lowerHref = url.href.toLowerCase();\n\n  return (\n    url.protocol === 'https:' && // only allow https\n    !urlSubstringBlacklist.some((blacklisted) =>\n      url.hostname.toLowerCase().includes(blacklisted)\n    ) && // disallow any url containing a blacklisted substring\n    !urlExactBlacklist.includes(lowerHref) && // disallow any url that exactly matches a blacklisted string\n    isIP(url.hostname) === 0 // disallow any url that is a simple IP address\n  );\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"RouteKind\", {\n    enumerable: true,\n    get: function() {\n        return RouteKind;\n    }\n});\nvar RouteKind;\n(function(RouteKind) {\n    /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */ RouteKind[\"PAGES\"] = \"PAGES\";\n    /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */ RouteKind[\"PAGES_API\"] = \"PAGES_API\";\n    /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */ RouteKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */ RouteKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n})(RouteKind || (RouteKind = {}));\n\n//# sourceMappingURL=route-kind.js.map","\"use strict\";\nif (process.env.NEXT_RUNTIME === \"edge\") {\n    module.exports = require(\"next/dist/server/future/route-modules/pages-api/module.js\");\n} else {\n    if (process.env.NODE_ENV === \"development\") {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.dev.js\");\n    } else if (process.env.TURBOPACK) {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js\");\n    } else {\n        module.exports = require(\"next/dist/compiled/next-server/pages-api.runtime.prod.js\");\n    }\n}\n\n//# sourceMappingURL=module.compiled.js.map"],"names":["module","exports","require","userProvidedHandler","handler","req","res","form","formidable","fields","files","parse","url","method","header","query","cookie","_cookie","JSON","requestInfo","isSafeRequestUrl","send","error","errorMessage","data","toFormData","headers","response","axios","params","paramsSerializer","indexes","responseEncoding","validateStatus","transformResponse","status","statusText","console","isAxiosError","request","formData","FormData","Object","entries","forEach","key","file","formidableFile","fileBuffer","fs","filepath","blob","Blob","type","mimetype","append","originalFilename","value","api","bodyParser","serverComponentModule","userApiModule","default","origConfig","config","externalResolver","wrappedHandler","_sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__","wrapApiHandlerWithSentry","wrappedHandler$1","defineProperty","enumerable","get","hoist","name","then","mod","__WEBPACK_DEFAULT_EXPORT__","next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__","l","private_next_pages_api_fileRequest_ts__WEBPACK_IMPORTED_MODULE_3__","routeModule","next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__","PagesAPIRouteModule","definition","kind","next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__","x","PAGES_API","page","pathname","bundlePath","filename","userland","external_net_namespaceObject","urlSubstringBlacklist","urlExactBlacklist","urlString","URL","lowerHref","href","toLowerCase","protocol","some","hostname","includes","blacklisted","isIP","RouteKind","__webpack_require__"],"sourceRoot":""}